---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 03-farver.md in _episodes_rmd/
title: "Farver og striber"
keypoints:
- Use the `dplyr` package to manipulate dataframes.
- Use `select()` to choose variables from a dataframe.
- Use `filter()` to choose data based on values.
- Use `group_by()` and `summarize()` to work with subsets of data.
- Use `mutate()` to create new variables.
- Use the `tidyr` package to change the layout of dataframes.
- Use `pivot_wider()` to go from long to wide format.
- Use `pivot_longer()` to go from wide to long format.
objectives:
- Describe the purpose of an R package and the **`dplyr`** and **`tidyr`** packages.
- Select certain columns in a dataframe with the **`dplyr`** function `select`.
- Select certain rows in a dataframe according to filtering conditions with the **`dplyr`**
  function `filter`.
- Link the output of one **`dplyr`** function to the input of another function with
  the 'pipe' operator `%>%`.
- Add new columns to a dataframe that are functions of existing columns with `mutate`.
- Use the split-apply-combine concept for data analysis.
- Use `summarize`, `group_by`, and `count` to split a dataframe into groups of observations,
  apply a summary statistics for each group, and then combine the results.
- Describe the concept of a wide and a long table format and for which purpose those
  formats are useful.
- Describe the roles of variable names and their associated values when a table is
  reshaped.
- Reshape a dataframe from long to wide format and back with the `pivot_wider` and
  `pivot_longer` commands from the **`tidyr`** package.
- Export a dataframe to a csv file.
questions:
- How can I select specific rows and/or columns from a dataframe?
- How can I combine multiple commands into a single command?
- How can I create new columns or remove existing columns from a dataframe?
- How can I reformat a dataframe to meet my needs?
teaching: 50
exercises: 30
source: Rmd
---





## Color blind friendly colors ##


> ## Note
>
> The packages in the tidyverse, namely **`dplyr`**, **`tidyr`** and **`ggplot2`**
> accept both the British (e.g. *summarise*) and American (e.g. *summarize*) spelling
> variants of different function and option names. For this lesson, we utilize
> the American spellings of different functions; however, feel free to use
> the regional variant for where you are teaching.
{: .callout}


efterfølgende ting knækker hvis vi piller ved denne kodeblok, så vi beholder
den til vi har fjernet disse efterfølgende ting.


~~~
## load the tidyverse
library(tidyverse)

interviews <- read_csv("data/SAFI_clean.csv", na = "NULL")

## inspect the data
interviews

## preview the data
# view(interviews)
~~~
{: .language-r}





~~~
interviews2 <- filter(interviews, village == "Chirodzo")
interviews_ch <- select(interviews2, village:respondent_wall_type)
~~~
{: .language-r}


~~~
interviews_ch <- select(filter(interviews, village == "Chirodzo"),
                         village:respondent_wall_type)
~~~
{: .language-r}



~~~
interviews_ch <- interviews %>%
    filter(village == "Chirodzo") %>%
    select(village:respondent_wall_type)

interviews_ch
~~~
{: .language-r}



~~~
# A tibble: 39 × 5
   village  interview_date      no_membrs years_liv respondent_wall_type
   <chr>    <dttm>                  <dbl>     <dbl> <chr>               
 1 Chirodzo 2016-11-16 00:00:00        12        70 burntbricks         
 2 Chirodzo 2016-11-16 00:00:00         8         6 burntbricks         
 3 Chirodzo 2016-12-16 00:00:00        12        23 burntbricks         
 4 Chirodzo 2016-11-17 00:00:00         8        18 burntbricks         
 5 Chirodzo 2016-11-17 00:00:00         5        45 muddaub             
 6 Chirodzo 2016-11-17 00:00:00         6        23 sunbricks           
 7 Chirodzo 2016-11-17 00:00:00         3         8 burntbricks         
 8 Chirodzo 2016-11-17 00:00:00         7        29 muddaub             
 9 Chirodzo 2016-11-17 00:00:00         2         6 muddaub             
10 Chirodzo 2016-11-17 00:00:00         9         7 muddaub             
# … with 29 more rows
~~~
{: .output}


> ## Exercise
>
>  Using pipes, subset the `interviews` data to include interviews
> where respondents were members of an irrigation association
> (`memb_assoc`) and retain only the columns `affect_conflicts`,
> `liv_count`, and `no_meals`.
>
> > ## Solution
> >
> > 
> > ~~~
> > interviews %>%
> >     filter(memb_assoc == "yes") %>%
> >     select(affect_conflicts, liv_count, no_meals)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > # A tibble: 33 × 3
> >    affect_conflicts liv_count no_meals
> >    <chr>                <dbl>    <dbl>
> >  1 once                     3        2
> >  2 never                    2        2
> >  3 never                    2        3
> >  4 once                     3        2
> >  5 frequently               1        3
> >  6 more_once                5        2
> >  7 more_once                3        2
> >  8 more_once                2        3
> >  9 once                     3        3
> > 10 never                    3        3
> > # … with 23 more rows
> > ~~~
> > {: .output}
> {: .solution}
{: .challenge}


![](../fig/tidyr-pivot_wider_longer.gif)



![](../fig/pivot_long_to_wide.png)




~~~
interviews_long <- interviews_wide %>%
    pivot_longer(cols = c(burntbricks, cement, muddaub, sunbricks),
                 names_to = "respondent_wall_type",
                 values_to = "wall_type_logical") %>%
    filter(wall_type_logical) %>%
    select(-wall_type_logical)
~~~
{: .language-r}



~~~
Error in pivot_longer(., cols = c(burntbricks, cement, muddaub, sunbricks), : object 'interviews_wide' not found
~~~
{: .error}



~~~
interviews_items_owned <- interviews %>%
  separate_rows(items_owned, sep = ";") %>%
  replace_na(list(items_owned = "no_listed_items")) %>%
  mutate(items_owned_logical = TRUE) %>%
    pivot_wider(names_from = items_owned,
                values_from = items_owned_logical,
                values_fill = list(items_owned_logical = FALSE))

nrow(interviews_items_owned)
~~~
{: .language-r}



~~~
[1] 131
~~~
{: .output}



~~~
interviews_items_owned <- interviews %>%
~~~
{: .language-r}



~~~
replace_na(list(items_owned = "no_listed_items")) %>%
~~~
{: .language-r}



~~~
mutate(items_owned_logical = TRUE) %>%
~~~
{: .language-r}


~~~
pivot_wider(names_from = items_owned,
            values_from = items_owned_logical,
            values_fill = list(items_owned_logical = FALSE))
~~~
{: .language-r}

View the `interviews_items_owned` dataframe. It should have
131 rows (the same number of rows you had originally), but
extra columns for each item. How many columns were added?







~~~
interviews_plotting <- interviews %>%
  ## pivot wider by items_owned
  separate_rows(items_owned, sep = ";") %>%
  ## if there were no items listed, changing NA to no_listed_items
  replace_na(list(items_owned = "no_listed_items")) %>%
  mutate(items_owned_logical = TRUE) %>%
  pivot_wider(names_from = items_owned,
              values_from = items_owned_logical,
              values_fill = list(items_owned_logical = FALSE)) %>%
  ## pivot wider by months_lack_food
  separate_rows(months_lack_food, sep = ";") %>%
  mutate(months_lack_food_logical = TRUE) %>%
  pivot_wider(names_from = months_lack_food,
              values_from = months_lack_food_logical,
              values_fill = list(months_lack_food_logical = FALSE)) %>%
  ## add some summary columns
  mutate(number_months_lack_food = rowSums(select(., Jan:May))) %>%
  mutate(number_items = rowSums(select(., bicycle:car)))
~~~
{: .language-r}

Now we can save this dataframe to our `data_output` directory.


~~~
write_csv (interviews_plotting, file = "data_output/interviews_plotting.csv")
~~~
{: .language-r}



{% include links.md %}
